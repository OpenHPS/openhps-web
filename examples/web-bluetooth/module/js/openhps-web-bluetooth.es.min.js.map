{"version":3,"file":"web/openhps-web-bluetooth.es.min.js","mappings":"oFACA,IAAIA,EAAsB,CCA1BA,EAAwB,CAACC,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXF,EAAoBI,EAAEF,EAAYC,KAASH,EAAoBI,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDH,EAAwB,CAACS,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,I,kCCElF,MAAM,EAFEI,KAAO,IAAIC,EAAI,CAAC,EAAgC,OAA7Bf,EAAoBgB,EAAED,EAAGD,GAAWC,CAAC,EAE3BA,CAAE,CAAE,WAAgB,IAAME,EAA6DC,aCA5H,MAAM,EAFEJ,KAAO,IAAIC,EAAI,CAAC,EAAgC,OAA7Bf,EAAoBgB,EAAED,EAAGD,GAAWC,CAAC,EAE3B,CAAE,CAAE,UAAe,IAAMI,EAA2DC,UAAW,YAAiB,IAAMD,EAA2DE,YAAa,aAAkB,IAAMF,EAA2DG,eCI/S,MAAMC,sBAAsB,EAAAL,WAC/BM,YAAYC,GACR,IAAIC,EACJC,MAAMF,GACNG,KAAKH,QAAQI,OAAwC,QAA9BH,EAAKE,KAAKH,QAAQI,cAA2B,IAAPH,EAAgBA,GAAK,IAAI,EAAAN,WAAYU,OAAOF,KAAKG,KAC9GH,KAAKI,KAAK,QAASJ,KAAKK,WAAWC,KAAKN,OACxCA,KAAKI,KAAK,UAAWJ,KAAKO,KAAKD,KAAKN,MACxC,CACAK,aACI,OAAO,IAAIG,SAAQ,CAACC,EAASC,KAEzB,GADAV,KAAKW,UAAYC,UAAUD,WACtBX,KAAKW,YAAcX,KAAKW,UAAUE,cACnC,OAAOH,EAAO,IAAII,MAAM,yCAE5Bd,KAAKW,UAAUI,iBAAiB,wBAAyBf,KAAKgB,gBAAgBV,KAAKN,OACnFS,GAAS,GAEjB,CACAQ,oBACI,OAAO,IAAIT,SAASC,IAShBA,GAAS,GAEjB,CACAS,QACI,OAAO,IAAIV,SAAQ,CAACC,EAASC,KACzBV,KAAKW,UACAE,cAAc,CACfM,yBAAyB,EACzBC,qBAAqB,EACrBC,QAASrB,KAAKH,QAAQwB,UAErBC,MAAMC,IACHvB,KAAKuB,MACLvB,KAAKuB,KAAKhB,OAEdP,KAAKuB,KAAOA,EACZd,GAAS,IAERe,MAAMd,EAAO,GAE1B,CACAH,OACQP,KAAKuB,MACLvB,KAAKuB,KAAKhB,MAElB,CACAkB,SACI,OAAO,IAAIjB,SAAQ,CAACC,EAASC,KACpBV,KAAKkB,MAMNT,OAAQiB,GALR1B,KAAKkB,QACAI,MAAK,IAAMb,OAAQiB,KACnBF,MAAMd,EAIf,GAER,CACAM,gBAAgBW,GACZ3B,KAAK4B,OAAO,QAAS,oBAAqBD,GAC1C,MAAME,EAAQ,IAAI,EAAApC,YACZqC,EAAS,IAAI,EAAAtC,UACnBsC,EAAO3B,IAAMwB,EAAMI,OAAOC,GAC1BF,EAAOG,YAAcN,EAAMI,OAAOG,KAClC,MAAMC,EAAmB1D,OAAO2D,OAAOT,EAAMQ,kBACzCA,EAAiBE,OAAS,GAC1BP,EAAOQ,sBAAsBH,EAAiB,GAAGI,QAErDV,EAAMW,UAAUV,GAChBD,EAAM5B,OAASD,KAAKC,OACpB4B,EAAM5B,OAAOwC,kBAAkBC,SAASC,GAAQd,EAAM5B,OAAO2C,wBAAwBD,EAAIE,sBACzFhB,EAAM5B,OAAO6C,oBAAoB,IAAI,EAAApD,aAAaoC,EAAQH,EAAMoB,OAChE/C,KAAKgD,KAAKnB,EACd,E","sources":["webpack://@openhps/web-bluetooth/webpack/bootstrap","webpack://@openhps/web-bluetooth/webpack/runtime/define property getters","webpack://@openhps/web-bluetooth/webpack/runtime/hasOwnProperty shorthand","webpack://@openhps/web-bluetooth/external module \"./openhps-core.es.min.js\"","webpack://@openhps/web-bluetooth/external module \"./openhps-rf.es.min.js\"","webpack://@openhps/web-bluetooth/./dist/esm/BLESourceNode.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }\nvar y = x => () => x\nconst __WEBPACK_NAMESPACE_OBJECT__ = x({ [\"SourceNode\"]: () => __WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__.SourceNode });","var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }\nvar y = x => () => x\nconst __WEBPACK_NAMESPACE_OBJECT__ = x({ [\"BLEObject\"]: () => __WEBPACK_EXTERNAL_MODULE__openhps_rf_es_min_js_8cbe06bd__.BLEObject, [\"RFDataFrame\"]: () => __WEBPACK_EXTERNAL_MODULE__openhps_rf_es_min_js_8cbe06bd__.RFDataFrame, [\"RelativeRSSI\"]: () => __WEBPACK_EXTERNAL_MODULE__openhps_rf_es_min_js_8cbe06bd__.RelativeRSSI });","/// <reference types=\"web-bluetooth\" />\r\nimport { SourceNode } from '@openhps/core';\r\nimport { BLEObject, RelativeRSSI, RFDataFrame } from '@openhps/rf';\r\n/**\r\n * BLE source node using Web Bluetooth API\r\n */\r\nexport class BLESourceNode extends SourceNode {\r\n    constructor(options) {\r\n        var _a;\r\n        super(options);\r\n        this.options.source = (_a = this.options.source) !== null && _a !== void 0 ? _a : new BLEObject().setUID(this.uid);\r\n        this.once('build', this._onBleInit.bind(this));\r\n        this.once('destroy', this.stop.bind(this));\r\n    }\r\n    _onBleInit() {\r\n        return new Promise((resolve, reject) => {\r\n            this.bluetooth = navigator.bluetooth;\r\n            if (!this.bluetooth || !this.bluetooth.requestLEScan) {\r\n                return reject(new Error('Bluetooth scanning is not supported!'));\r\n            }\r\n            this.bluetooth.addEventListener('advertisementreceived', this.onAdvertisement.bind(this));\r\n            resolve();\r\n        });\r\n    }\r\n    requestPermission() {\r\n        return new Promise((resolve) => {\r\n            // navigator.permissions.query({ name: 'bluetooth' as PermissionName }).then((result) => {\r\n            //     if (result.state === 'granted') {\r\n            //         resolve();\r\n            //     } else {\r\n            //         reject(new Error(`No permission to use Bluetooth scanning!`));\r\n            //     }\r\n            // })\r\n            // .catch(reject);\r\n            resolve();\r\n        });\r\n    }\r\n    start() {\r\n        return new Promise((resolve, reject) => {\r\n            this.bluetooth\r\n                .requestLEScan({\r\n                acceptAllAdvertisements: true,\r\n                keepRepeatedDevices: true,\r\n                filters: this.options.filters\r\n            })\r\n                .then((scan) => {\r\n                if (this.scan) {\r\n                    this.scan.stop();\r\n                }\r\n                this.scan = scan;\r\n                resolve();\r\n            })\r\n                .catch(reject);\r\n        });\r\n    }\r\n    stop() {\r\n        if (this.scan) {\r\n            this.scan.stop();\r\n        }\r\n    }\r\n    onPull() {\r\n        return new Promise((resolve, reject) => {\r\n            if (!this.start) {\r\n                this.start()\r\n                    .then(() => resolve(undefined))\r\n                    .catch(reject);\r\n            }\r\n            else {\r\n                resolve(undefined);\r\n            }\r\n        });\r\n    }\r\n    onAdvertisement(event) {\r\n        this.logger('debug', 'BLE Advertisement', event);\r\n        const frame = new RFDataFrame();\r\n        const object = new BLEObject();\r\n        object.uid = event.device.id;\r\n        object.displayName = event.device.name;\r\n        const manufacturerData = Object.values(event.manufacturerData);\r\n        if (manufacturerData.length > 0) {\r\n            object.parseManufacturerData(manufacturerData[0].buffer);\r\n        }\r\n        frame.addObject(object);\r\n        frame.source = this.source;\r\n        frame.source.relativePositions.forEach((pos) => frame.source.removeRelativePositions(pos.referenceObjectUID));\r\n        frame.source.addRelativePosition(new RelativeRSSI(object, event.rssi));\r\n        this.push(frame);\r\n    }\r\n}\r\n//# sourceMappingURL=BLESourceNode.js.map"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","y","x","d","__WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__","SourceNode","__WEBPACK_EXTERNAL_MODULE__openhps_rf_es_min_js_8cbe06bd__","BLEObject","RFDataFrame","RelativeRSSI","BLESourceNode","constructor","options","_a","super","this","source","setUID","uid","once","_onBleInit","bind","stop","Promise","resolve","reject","bluetooth","navigator","requestLEScan","Error","addEventListener","onAdvertisement","requestPermission","start","acceptAllAdvertisements","keepRepeatedDevices","filters","then","scan","catch","onPull","undefined","event","logger","frame","object","device","id","displayName","name","manufacturerData","values","length","parseManufacturerData","buffer","addObject","relativePositions","forEach","pos","removeRelativePositions","referenceObjectUID","addRelativePosition","rssi","push"],"sourceRoot":""}